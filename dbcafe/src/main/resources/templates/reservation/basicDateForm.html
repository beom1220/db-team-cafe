<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>모임 예약 페이지</title>
    <link th:href="@{/css/globals.css}" href="../static/css/globals.css" rel="stylesheet">
    <link th:href="@{/css/reservation.css}" href="../static/css/reservation.css" rel="stylesheet">
</head>
<body>
<div th:insert="fragments/navigation/topBar :: topBar"></div>
<div class="container">
    <div class="box">
        <div th:each="day : ${days}">
            <p th:text="${day.date}">데이터</p>
        </div>
        <div class="content-box">
            <div class="text-box">
                <p class="content-text">* 모임 예약은 최소 6명에서 10명 이내의 인원만 수용이 가능합니다.</p>
                <p class="content-text">* 누적 금액에 따라 예약 기간의 차이가 있습니다.(0~30만원(2주), 30~100만원(4주), 100~200만원(6주), 200~(8주))</p>
                <p class="content-text">* 월~목요일은 주중 할인율 5%가 적용됩니다.</p>
                <p class="content-text">* 2주 이상의 날짜를 예약하면 얼리버드 할인이 적용됩니다.</p>
            </div>
            <div class="calendar">
                <div class="month-row">
                    <button id="prevMonthBtn" class="monthButton">&lt;</button>
                    <h1 id="currentMonth">12월</h1>
                    <button id="nextMonthBtn" class="monthButton">&gt;</button>
                </div>
                <hr>
                <div id="calendarContainer"></div> <!-- 달력 -->
                <div class="right-box">
                    <button class="reservationButton">예약 정보 입력하기</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function getCurrentYearMonth() {
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth() + 1;
      const day = today.getDate();
      return { year, month, day };
    }

    // 달력을 생성하는 함수
    function generateCalendar(year, month, today, highlightedDates) {
      const daysInMonth = new Date(year, month, 0).getDate();
      const firstDayOfMonth = new Date(year, month - 1, 1).getDay();

      const calendarContainer = document.getElementById('calendarContainer');
      calendarContainer.innerHTML = '';

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const tbody = document.createElement('tbody');

      const headerRow = document.createElement('tr');
      const daysOfWeek = ['일', '월', '화', '수', '목', '금', '토'];
      for (const day of daysOfWeek) {
        const th = document.createElement('th');
        th.textContent = day;
        headerRow.appendChild(th);
      }
      thead.appendChild(headerRow);
      table.appendChild(thead);

      let dayCounter = 1;
      for (let i = 0; i < 6; i++) {
        const row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
          const td = document.createElement('td');
          if (i === 0 && j < firstDayOfMonth) {
            td.textContent = '';
          } else if (dayCounter <= daysInMonth) {
            td.textContent = dayCounter;

            if (today.year === year && today.month === month && today.day === dayCounter) {
              td.classList.add('today');
            }

            const currentDate = new Date(year, month - 1, dayCounter);
            const formattedDate = `${year}-${month.toString().padStart(2, '0')}-${dayCounter.toString().padStart(2, '0')}`;

            if (dayCounter == today.day) {
              td.classList.add('today');
            }

            if (highlightedDates.includes(formattedDate)) {
              td.classList.add('in2weeks');
            }

            dayCounter++;
          }
          row.appendChild(td);
        }
        tbody.appendChild(row);
      }
      table.appendChild(tbody);
      calendarContainer.appendChild(table);
    }

    function updateCurrentMonth(year, month) {
      const currentMonthElement = document.getElementById('currentMonth');
      currentMonthElement.textContent = `${month}월`;
    }

    document.getElementById('prevMonthBtn').addEventListener('click', function () {
      const { year, month } = getCurrentYearMonth();
      const today = { year, month, day: 1 };
      if (month === 1) {
        generateCalendar(year - 1, 12, today, []);
        updateCurrentMonth(year - 1, 12);
      } else {
        generateCalendar(year, month - 1, today, []);
        updateCurrentMonth(year, month - 1);
      }
      updatePrevButtonVisibility();
    });

    document.getElementById('nextMonthBtn').addEventListener('click', function () {
      const { year, month } = getCurrentYearMonth();
      const today = { year, month, day: 1 };
      if (month === 12) {
        generateCalendar(year + 1, 1, today, []);
        updateCurrentMonth(year + 1, 1);
      } else {
        generateCalendar(year, month + 1, today, []);
        updateCurrentMonth(year, month + 1);
      }
    });

    function updatePrevButtonVisibility() {
      const { year, month } = getCurrentYearMonth();
      const prevMonthBtn = document.getElementById('prevMonthBtn');
      prevMonthBtn.style.display = (year === today.year && month === today.month) ? 'none' : 'block';
    }

    const { year, month } = getCurrentYearMonth();
    const today = getCurrentYearMonth();
    generateCalendar(year, month, today, []);
    updateCurrentMonth(year, month);
    updatePrevButtonVisibility();
</script>
</body>
</html>
